---
title: "Project 1"
author: "Name:  \n Partner: "
date: "`r Sys.Date()`"
output: 
  html_document:
    toc: true
    toc_depth: 3
header-includes:
  - \usepackage{booktabs}
  - \usepackage{longtable}
  - \usepackage{array}
  - \usepackage{multirow}
  - \usepackage{wrapfig}
  - \usepackage{float}
  - \usepackage{colortbl}
  - \usepackage{pdflscape}
  - \usepackage{tabu}
  - \usepackage{threeparttable}
  - \usepackage{threeparttablex}
  - \usepackage[normalem]{ulem}
  - \usepackage{makecell}
  - \usepackage{xcolor}
---
```{r setup, include = FALSE}
#### Load necessary packages ####
# * These packages are not necessary to complete the assignment and or only used 
#   to provide an example. 
packages <- c("knitr", "kableExtra", "magrittr", "readr", "geosphere", "dplyr")
install_me <- packages[!(packages %in% installed.packages()[, "Package"])]
if (length(install_me)) install.packages(install_me)
library(knitr)
library(kableExtra)
library(magrittr)
library(readr)
library(geosphere)
library(dplyr)
```

## Background
The World Health Organization has recently employed a new data science initiative, *CSIT-165*, that uses data science to characterize pandemic diseases. 
*CSIT-165* disseminates data driven analyses to global decision makers.

*CSIT-165* is a conglomerate comprised of two fabricated entities: *Global Health Union (GHU)* and *Private Diagnostic Laboratories (PDL)*. 
Your and your partner's role is to play a data scientist from one of these two entities.

## Data
> [2019 Novel Coronavirus COVID-19 (2019-nCoV) Data Repository by John Hopkins CSSE](https://github.com/CSSEGISandData/COVID-19/tree/master/csse_covid_19_data/csse_covid_19_time_series)
Data for 2019 Novel Coronavirus is operated by the John Hopkins University Center for Systems Science and Engineering (JHU CSSE).
Data includes daily time series CSV summary tables, including confirmations, recoveries, and deaths. 
Country/region are countries/regions hat conform to World Health Organization (WHO).
Lat and Long refer to coordinates references for the user. 
Date fields are stored in MM/DD/YYYY format.

## Project Objectives

### Objective 1: What was the origin country of the COVID-19 outbreak?
```{r ob1}
#load data
confirmed_cases <- "https://raw.githubusercontent.com/CSSEGISandData/COVID-19/master/csse_covid_19_data/csse_covid_19_time_series/time_series_covid19_confirmed_global.csv"
covid_deaths <- "https://raw.githubusercontent.com/CSSEGISandData/COVID-19/master/csse_covid_19_data/csse_covid_19_time_series/time_series_covid19_deaths_global.csv"

cases_df <- read.csv(confirmed_cases, header = TRUE, na.strings = c("", " "))
deaths_df <- read.csv(covid_deaths, header = TRUE, na.strings = c("", " "))

#segment first day of COVID data
data_cases <- dplyr::select(cases_df, Province.State, Country.Region, X1.22.20); 
data_deaths <- dplyr::select(deaths_df, Province.State, Country.Region, X1.22.20)

# Filter for the first day and select relevant columns
first_day_cases <- cases_df %>%
  filter(X1.22.20 != 0) %>%
  select(Province.State, Country.Region, X1.22.20)
first_day_deaths <- deaths_df %>%
  filter(X1.22.20 != 0) %>%
  select(Province.State, Country.Region, X1.22.20)

# Identify the area with the highest confirmed cases and highest deaths
max_cases <- first_day_cases %>%
  filter(X1.22.20 == max(X1.22.20)) %>%
  pull(Province.State)
max_deaths <- first_day_deaths %>%
  filter(X1.22.20 == max(X1.22.20)) %>%
  pull(Province.State)

# Determine if the area(s) identified is the origin of the outbreak
if(max_cases == max_deaths) {
  output <- paste("The origin of the COVID-19 outbreak was likely", max_cases)
  print(output)
}
```

### Objective 2: Where is the most recent area to have a first confirmed case?

```{r ob2}

# iterates through each (date-containing) column 
for(date_column in (5:ncol(cases_df))){
  
  # iterates through each row (case count) for that specific date
  for(x in (1:length(cases_df[,date_column]))){ # subsets the column for a single date
    if(cases_df[x, date_column] == 1 & cases_df[x, date_column-1] == 0){ # checks if there is a new case 
      newest_case <- cases_df[x, 2] # updates variable with the corresponding country name (column 2) 
    }
  }
}

cat("The most recent area to have a first confirmed case is", newest_case)

```

### Objective 3
```{r ob3}
recent_region <- "Korea, North"
origin_city <- "Hubei"
origin_country <- "China"

origin_lat = cases_df[which(cases_df$Province.State == origin_city), 3]
origin_long = cases_df[which(cases_df$Province.State == origin_city), 4]
origin_coordinates <- c(origin_long, origin_lat)


recent_lat = cases_df[which(cases_df$Country.Region == recent_region), 3]
recent_long = cases_df[which(cases_df$Country.Region == recent_region), 4]
recent_coordinates <- c(recent_long, recent_lat)

distance = distm(origin_coordinates, recent_coordinates, fun=distGeo)
miles_distance = distance/1609

sprintf("%s is %f miles away from %s, %s", recent_region, miles_distance, origin_city, origin_country)




```

### Objective 4

#### Objective 4.1
```{r ob4.1}

#filter out cruise ship data from the data sets
cases_df <- cases_df[!(is.na(cases_df$Lat) | cases_df$Lat == 0),]
deaths_df <- deaths_df[!(is.na(deaths_df$Lat) | deaths_df$Lat == 0),]

# Extract the most recent date
most_recent_date <- tail(colnames(cases_df), 1)
print(most_recent_date)


# Extract the columns for the most recent date
confirmed_cases_latest<- dplyr::select(cases_df, Province.State, Country.Region, ncol(cases_df)); 
deaths_latest  <- dplyr::select(deaths_df, Province.State, Country.Region, ncol(deaths_df))

#merge the data sets into one
merged_df <- merge(confirmed_cases_latest, deaths_latest, by = c("Province.State", "Country.Region"))

# Calculate risk scores for the most recent date
confirmed_cases_latest <- "X3.9.23.x"
deaths_latest <- "X3.9.23.y"
risk_scores_latest <- merged_df[,deaths_latest] / merged_df[,confirmed_cases_latest] * 100
#risk_scores_latest <- #as.numeric(as.matrix(risk_scores_latest)))
# Add risk scores to the end of the table as a new column
mutate(merged_df, risk_score = risk_scores_latest)
head(merged_df)

```
```
# Find the minimum risk score across all provinces for the most recent date
min_risk_score_latest <- min(risk_scores_latest, na.rm = TRUE)
print(min_risk_score_latest)

#Find the provinces with the minimum risk score for the most recent date
min_risk_provinces <- risk_scores_latest
head( min_risk_provinces)
```
# Where I'm stuck


```
# Filter cases_df to only include the provinces with the minimum risk score for the most recent date
min_risk_cases_latest <- cases_df[, c(1:4, min_risk_provinces_latest, most_recent_date)]
```
# Find the province with the most confirmed cases among those with the minimum risk score for the most recent date
max_cases_province_latest <- min_risk_cases_latest[which.max(min_risk_cases_latest[, ncol(min_risk_cases_latest) - 1]), "Province.State"]

# Extract the confirmed cases number for the province with the lowest risk score and the most confirmed cases for the most recent date
max_cases_confirmed_latest <- min_risk_cases_latest[which(min_risk_cases_latest[, "Province.State"] == max_cases_province_latest), most_recent_date]

# Output the result
paste("The province with the lowest risk score and the most confirmed cases on", most_recent_date, "is", max_cases_province_latest.")

```

#### Objective 4.2
```{r ob4.2}
```

### GitHub Log
```{bash gitlog} 
git log --pretty=format:"%nSubject: %s%nAuthor: %aN%nDate: %aD%nBody: %b"
```
